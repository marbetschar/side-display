app-id: com.github.marbetschar.side-display
runtime: io.elementary.Platform
runtime-version: '6'
sdk: io.elementary.Sdk
command: com.github.marbetschar.side-display
finish-args:
  - '--share=ipc'
  - '--socket=fallback-x11'
  - '--socket=wayland'
modules:
  - name: gsettings-desktop-schemas
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gsettings-desktop-schemas/-/archive/41.0/gsettings-desktop-schemas-41.0.tar.gz
        sha256: bb7ec2687bcfbe5219e6df7f1c9860027ce02c37cd897c3b0969ba9752c288d6

  - name: glib-2.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/glib/-/archive/2.68.4/glib-2.68.4.tar.gz
        sha256: 7277475bebbecd3369b793c7b628d78290e016f7d6bcb463173c17e90f3bb96d

  - name: gnome-desktop-3.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gnome-desktop/-/archive/41.0/gnome-desktop-41.0.tar.gz
        sha256: 703dac9aad98c9f1fc2ea80324d78910a4771636831b3630f80521881d99a366

  - name: libcanberra
    cleanup:
      - '*.la'
      - '/bin'
      - '/etc'
      - '/include'
      - '/libexec'
      - '/share/gtk-doc'
      - '/share/man'
    config-opts:
      - '--disable-static'
      - '--disable-gtk-doc'
      - '--disable-oss'
      - '--enable-pulse'
      - '--disable-udev'
      - '--disable-gtk'
      - '--enable-gtk3'
      - '--disable-lynx'
    sources:
      - type: archive
        url: http://0pointer.de/lennart/projects/libcanberra/libcanberra-0.30.tar.xz
        sha256: c2b671e67e0c288a69fc33dc1b6f1b534d07882c2aceed37004bf48c601afa72
        git-init : true
      - type: patch
        path: patch/0001-gtk-Don-t-assume-all-GdkDisplays-are-GdkX11Displays-.patch
        use-git-am: true

  - name: mutter
    buildsystem: simple
    build-options:
      build-args:
        - '--share=network'
    build-commands:
      - sed -i "/gnome_settings_daemon_dep/d" meson.build
      - sed -i "/gnome_settings_daemon_dep/d" src/meson.build
      - meson build --prefix=/app -Dstartup_notification=false -Dnative_backend=false -Dtests=false -Dwayland=false -Dlibwacom=false -Dudev=false -Dremote_desktop=true
      - ninja -C build install
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/mutter/-/archive/40.5/mutter-40.5.tar.gz
        sha256: 0d7a4f08e5fe020c0078cccb7ac6fb2bcdaa65e4da8db73505a175f4e7208384

  - name: side-display
    buildsystem: meson
    sources:
      - type: dir
        path: .