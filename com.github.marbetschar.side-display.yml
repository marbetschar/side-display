app-id: com.github.marbetschar.side-display
runtime: io.elementary.Platform
runtime-version: '6'
sdk: io.elementary.Sdk
command: com.github.marbetschar.side-display
finish-args:
  - '--share=ipc'
  - '--socket=fallback-x11'
  - '--socket=wayland'
modules:
  - name: gsettings-desktop-schemas
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gsettings-desktop-schemas/-/archive/41.0/gsettings-desktop-schemas-41.0.tar.gz
        sha256: bb7ec2687bcfbe5219e6df7f1c9860027ce02c37cd897c3b0969ba9752c288d6

  - name: glib-2.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/glib/-/archive/2.68.4/glib-2.68.4.tar.gz
        sha256: 7277475bebbecd3369b793c7b628d78290e016f7d6bcb463173c17e90f3bb96d

  - name: geocode-glib-1.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/geocode-glib/-/archive/3.26.2/geocode-glib-3.26.2.tar.gz
        sha256: 589ed8cf890fb47619ad1062b7117d16104554078b837344496d603d0896ec20

  - name: gweather-3.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/libgweather/-/archive/40.0/libgweather-40.0.tar.gz
        sha256: 8b31f9257ec04fd252442543e272e6302d36a6c7e3f9dd97de474c1af502abdf

  - name: libcanberra-gtk3
    buildsystem: simple
    build-commands:
      - ./configure --prefix /app
      - make
      - make install
    sources:
      - type: archive
        url: http://0pointer.de/lennart/projects/libcanberra/libcanberra-0.30.tar.xz
        sha256: c2b671e67e0c288a69fc33dc1b6f1b534d07882c2aceed37004bf48c601afa72

  - name: intltool
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        md5: 12e517cac2b57a0121cda351570f1e63

  - name: polkit
    buildsystem: autotools
    config-opts:
      - --disable-polkitd
      - --disable-man-pages
      - --disable-introspection
      - --disable-examples
      - --disable-gtk-doc
      - --disable-libelogind
      - --disable-libsystemd-login
      - --with-systemdsystemunitdir=no
      - --with-authdb=dummy
      - --with-authfw=none
    rm-configure: true
    cleanup:
      - /bin/*
      - /etc/pam.d
      - /etc/dbus-1
      - /share/dbus-1/system-services/*
      - /share/polkit-1
      - /lib/polkit-1
    sources:
      - type: archive
        url: https://www.freedesktop.org/software/polkit/releases/polkit-0.116.tar.gz
        sha256: 88170c9e711e8db305a12fdb8234fac5706c61969b94e084d0f117d8ec5d34b1
      - type: patch
        path: flatpak-build/polkit-build-Add-option-to-build-without-polkitd.patch
      - type: file
        path: flatpak-build/polkit-autogen
        dest-filename: autogen.sh

  - name: gnome-desktop-3.0
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gnome-desktop/-/archive/41.0/gnome-desktop-41.0.tar.gz
        sha256: 703dac9aad98c9f1fc2ea80324d78910a4771636831b3630f80521881d99a366

  - name: gnome-settings-daemon
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/gnome-settings-daemon/-/archive/41.0/gnome-settings-daemon-41.0.tar.gz
        sha256: c94ea2385de3494f2d6dd4344ffc2759a8b684a7cc8ffa16b2fd2f84f0bb9c96

  - name: mutter
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/mutter/-/archive/40.5/mutter-40.5.tar.gz
        sha256: 0d7a4f08e5fe020c0078cccb7ac6fb2bcdaa65e4da8db73505a175f4e7208384

  - name: side-display
    buildsystem: meson
    sources:
      - type: dir
        path: .